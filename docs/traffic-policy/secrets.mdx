---
title: Traffic Policy Secrets
sidebar_label: Secrets
description: TK
---

Secrets enable you to store sensitive data in encrypted vaults and reference them dynamically in your traffic policies.
This feature eliminates the need to hardcode passwords, API keys, and other sensitive values directly in policy YAML files.

:::info
Secrets and Vaults are currently in Developer Preview.
Log into the [ngrok dashboard](https://dashboard.ngrok.com/developer-preview) to request access.
During the Developer Preview, the following limitations apply:

- Secrets management is only available via the ngrok API (no dashboard UI)
- Secrets interpolated into certain actions may appear in cleartext in Traffic Inspector when full capture mode is enabled
- Secrets are only supported in the fields listed in the [supported actions and fields section](#supported-actions-and-fields) below
:::

## How it works

Vaults are secure containers that store your secrets.
Each vault can contain multiple secrets, which are encrypted key-value pairs.
Secrets are stored using AES-256 encryption at rest and transmitted over HTTPS with TLS 1.2+.

When you reference a secret in a Traffic Policy, the value is evaluated at runtime and never persisted in policy documents or logs.
The ngrok API never returns secret values in response payloads.

Reference secrets in your Traffic Policy using the `secrets.get()` macro:

```yaml
secrets.get("vault-name", "secret-name")
```

The macro dynamically retrieves the secret value from the specified vault at runtime.

## Creating Vaults and Secrets

### Create a Vault

Use the ngrok Agent CLI to create a vault:

```shell
ngrok api vaults create --name "my-vault" --description "Description of vault purpose"
```

The response includes the vault ID, which you'll need when creating secrets within the vault:

```json
{
  "id": "vault_2yNPzuk6GjHrx3mlOCkJK42RsdR",
  "name": "my-vault",
  "description": "Description of vault purpose",
  "created_at": "2025-08-01T21:10:37Z",
  "uri": "https://api.ngrok.com/vaults/vault_2yNPzuk6GjHrx3mlOCkJK42RsdR"
}
```

### Create a Secret

Create a secret within a vault using the vault ID:

```shell
ngrok api secrets create \
  --name "my-secret" \
  --value "secret-value" \
  --vault-id "vault_2yNPzuk6GjHrx3mlOCkJK42RsdR" \
  --description "Optional description"
```

## Using Secrets in Traffic Policies

### Supported actions and fields

Secrets are supported in the following Traffic Policy actions and fields:

- **basic-auth**: `credentials`
- **jwt-validation**: 
  - `issuer.allow_list[*].value`
  - `http.tokens[*].name`
  - `http.tokens[*].prefix`
  - `jws.keys[*].sources[*].additional_jkus`
- **oauth**: `client_secret`
- **oidc**: `client_secret`
- **restrict-ips**: `allow`, `deny`
- **set-vars**: `vars`
- **terminate-tls**:
  - `server_private_key`
  - `server_certificate`
  - `mutual_tls_certificate_authorities`
- **verify-webhook**: `secret`

## Common use cases for Secrets

### Basic authentication

```yaml
on_http_request:
  - actions:
      - type: basic-auth
        config:
          credentials:
            - "${secrets.get('my-vault', 'password')}"
```

### Webhook verification

```yaml
on_http_request:
  - actions:
      - type: verify-webhook
        config:
          provider: github
          secret: "${secrets.get('webhooks-vault', 'github-secret')}"
```

## Audit events

### Vault events

| Event | Description |
|-------|-------------|
| `vault_created.v0` | Triggered when a vault is created |
| `vault_deleted.v0` | Triggered when a vault is deleted |
| `vault_updated.v0` | Triggered when a vault is updated (name, description, metadata) |

### Secret events

| Event | Description |
|-------|-------------|
| `secret_created.v0` | Triggered when a secret is created |
| `secret_deleted.v0` | Triggered when a secret is deleted |
| `secret_updated.v0` | Triggered when a secret is updated |

All audit events include the full resource details in the logs.

## Limits and pricing

TK

| Plan | Vault Limit | Secret Limit | Price/Vault | Price/Secret |
|------|-------------|--------------|-------------|--------------|
| Free | 5 (hard limit) | 5 total (hard limit) | $0.00 | $0.00 |
| Personal | 5 (hard limit) | 25 total (hard limit) | $0.00 | $0.00 |
| PayGo | 5 (soft limit, configurable) | 500 default (configurable) | $0.00 | $0.00 |

If you need higher limits than your plan provides, contact support.
